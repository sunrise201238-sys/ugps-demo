<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>UGPS</title>
    <style>
      body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif; margin: 24px; }
      .row { display:flex; gap:12px; align-items:center; margin-bottom:16px; }
      .badge { padding:6px 10px; border:1px solid #ddd; border-radius:999px; background:#fff; cursor:pointer; }
      .badge.active { background:#eef; border-color:#99f; }
      .card { border:1px solid #eee; border-radius:12px; padding:16px; }
      small{color:#777}
    </style>
  </head>
  <body>
    <div class="row">
      <h1 id="app.title">UGPS</h1>
      <div style="margin-left:auto">
        <button id="btn-zhtw" class="badge">zhtw</button>
        <button id="btn-enus" class="badge">enus</button>
      </div>
    </div>

    <div class="row">
      <a id="nav.home" href="#">首頁</a>
      <a id="nav.map" href="#" style="margin-left:12px">地圖</a>
      <a id="nav.export" href="#" style="margin-left:12px">匯出</a>
    </div>

    <div class="card">
      <b id="legend.title">Legend</b>
      <div class="row" style="margin-top:8px">
        <small id="map.legend.low">低</small>
        <div style="flex:1;height:8px;background:linear-gradient(90deg,#9cf,#fd6,#f66);border-radius:999px"></div>
        <small id="map.legend.high">高</small>
      </div>
    </div>

    <div class="card" id="top.card" style="margin-top:16px">
  <div class="row" style="margin:0 0 8px 0">
    <b id="top.title">Top-3</b>
    <button id="top.export" class="badge" style="margin-left:auto">Export</button>
  </div>
  <div id="top.list">
    <small>Loading…</small>
  </div>
</div>


    
    <script>
      const LANG_KEY = "ugps_lang";
      const supported = ["zhtw","enus"];
      let lang = localStorage.getItem(LANG_KEY) || "zhtw";

      async function loadLang(l){
        try {
          if (!supported.includes(l)) l = "zhtw";

          // 讀取語言檔
          const res = await fetch(`./locales/${l}.json`, { cache: "no-cache" });
          if (!res.ok) throw new Error(`fetch ${l}.json failed: ${res.status}`);
          const dict = await res.json();

          // 依 key 替換畫面文字
          Object.keys(dict).forEach(k => {
            const el = document.getElementById(k);
            if (el) el.textContent = dict[k];
          });

          // 頁籤標題與 <html lang>
          document.title = dict["app.title"] || "UGPS";
          document.documentElement.setAttribute("lang", l === "zhtw" ? "zh-Hant" : "en");

          // 切換按鈕樣式
          document.getElementById("btn-zhtw").classList.toggle("active", l === "zhtw");
          document.getElementById("btn-enus").classList.toggle("active", l === "enus");

          // 記錄選擇
          localStorage.setItem(LANG_KEY, l);
          lang = l;
        } catch (e) {
          alert("載入語言檔失敗，請重整或稍後再試。\n" + e.message);
          console.error(e);
        }
      }

      // 綁定按鈕
      document.getElementById("btn-zhtw").onclick = () => loadLang("zhtw");
      document.getElementById("btn-enus").onclick = () => loadLang("enus");

      // 首次載入（避免快取）
      async function loadUGPS(){
  try {
    const res = await fetch("./data/ugps.json", { cache: "no-cache" });
    if(!res.ok) throw new Error("fetch ugps.json failed");
    const data = await res.json();

    // 取前 3 名（若已排序就直接用；否則先依 score 排序）
    const top = [...(data.grid || [])].sort((a,b)=> b.score - a.score).slice(0,3);

    // 簡單渲染成清單
    const toRow = (c,i)=>
      `<div style="display:flex;justify-content:space-between;padding:6px 8px;border:1px solid #eee;border-radius:8px;margin-top:6px">
         <span>${i+1}. ${c.id} (${c.lat.toFixed(4)}, ${c.lon.toFixed(4)})</span>
         <b>${(c.score*100).toFixed(0)}</b>
       </div>`;

    document.getElementById("top.list").innerHTML =
      top.length ? top.map(toRow).join("") : "<small>no data</small>";
  } catch(e){
    document.getElementById("top.list").innerHTML =
      `<small style="color:#b00">讀取資料失敗：${e.message}</small>`;
    console.error(e);
  }
}

      loadLang(lang);
      loadUGPS();
    </script>

    <div style="position:fixed;right:16px;bottom:16px;background:#fff;border:1px solid #eee;border-radius:10px;padding:8px 12px;font-size:12px;color:#555">
      <b id="meta.dataSource">資料來源</b>：OSM / Gov Open Data　|　
      <b id="meta.version">版本</b>：v0.0.1
    </div>
  </body>
</html>
